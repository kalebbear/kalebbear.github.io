(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-dc243f1a"],{afb2:function(e,t,r){"use strict";r("f527")},d416:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"products-container"},[t("el-card",{staticClass:"card"},[t("div",{staticClass:"title"},[e._v("【商品管理】")]),t("div",{staticClass:"center"},[t("div",{staticClass:"search-bar"},[t("el-input",{staticClass:"search-input",attrs:{placeholder:"请输入商品名称"},model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}}),t("el-button",{staticClass:"search-button",attrs:{type:"primary"},on:{click:e.searchProducts}},[e._v("搜索")]),t("el-button",{staticClass:"search-button",attrs:{type:"success"},on:{click:e.showAddProductDialog}},[e._v("新增商品")])],1),t("el-table",{staticClass:"product-table",staticStyle:{width:"100%"},attrs:{data:e.products,stripe:""}},[t("el-table-column",{attrs:{prop:"name",label:"商品名称",sortable:""}}),t("el-table-column",{attrs:{label:"商品图片"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-image",{staticStyle:{width:"80px",height:"80px"},attrs:{src:r.row.coverImage,fit:"cover","preview-src-list":[r.row.coverImage]},on:{click:function(t){return e.showImageDialog(r.row.coverImage)}}})]}}])}),t("el-table-column",{attrs:{prop:"salePrice",label:"售价",sortable:""}}),t("el-table-column",{attrs:{prop:"stockQuantity",label:"库存",sortable:""}}),t("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.viewProduct(r.row)}}},[e._v("查看")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.confirmDeleteProduct(r.row)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{staticClass:"pagination",attrs:{"current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.totalProducts},on:{"current-change":e.handlePageChange}})],1)]),t("el-dialog",{attrs:{title:"新增商品",visible:e.addProductDialogVisible},on:{"update:visible":function(t){e.addProductDialogVisible=t}}},[t("el-form",{ref:"newProductForm",attrs:{model:e.newProduct,rules:e.rules,"label-position":"top"}},[t("el-form-item",{attrs:{label:"商品名称",prop:"name"}},[t("el-input",{model:{value:e.newProduct.name,callback:function(t){e.$set(e.newProduct,"name",t)},expression:"newProduct.name"}})],1),t("el-form-item",{attrs:{label:"商品封面图片",prop:"coverImage"}},[t("el-input",{model:{value:e.newProduct.coverImage,callback:function(t){e.$set(e.newProduct,"coverImage",t)},expression:"newProduct.coverImage"}}),t("el-upload",{ref:"uploadCover",staticClass:"upload-demo",attrs:{action:e.uploadUrl,"before-upload":e.beforeUploadCover,"on-success":e.handleCoverUploadSuccess,"show-file-list":!1}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("上传图片")])],1)],1),t("el-form-item",{attrs:{label:"商品详情图片",prop:"detailImages"}},[t("el-upload",{ref:"uploadDetail",staticClass:"upload-demo",attrs:{action:e.uploadUrl,"before-upload":e.beforeUploadDetail,"on-success":e.handleDetailUploadSuccess,"list-type":"picture-card","file-list":e.detailImageList,"on-remove":e.handleDetailRemove}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("上传图片")])],1)],1),t("el-form-item",{attrs:{label:"商品描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.newProduct.description,callback:function(t){e.$set(e.newProduct,"description",t)},expression:"newProduct.description"}})],1),t("el-form-item",{attrs:{label:"销售价格",prop:"salePrice"}},[t("el-input",{model:{value:e.newProduct.salePrice,callback:function(t){e.$set(e.newProduct,"salePrice",t)},expression:"newProduct.salePrice"}})],1),t("el-form-item",{attrs:{label:"成本价格",prop:"costPrice"}},[t("el-input",{model:{value:e.newProduct.costPrice,callback:function(t){e.$set(e.newProduct,"costPrice",t)},expression:"newProduct.costPrice"}})],1),t("el-form-item",{attrs:{label:"库存数量",prop:"stockQuantity"}},[t("el-input",{model:{value:e.newProduct.stockQuantity,callback:function(t){e.$set(e.newProduct,"stockQuantity",t)},expression:"newProduct.stockQuantity"}})],1),t("el-form-item",{attrs:{label:"商品品牌",prop:"brand"}},[t("el-select",{attrs:{placeholder:"请选择品牌"},model:{value:e.newProduct.brand,callback:function(t){e.$set(e.newProduct,"brand",t)},expression:"newProduct.brand"}},e._l(e.brands,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"商品分类ID",prop:"categoryId"}},[t("el-select",{attrs:{placeholder:"请选择分类"},model:{value:e.newProduct.categoryId,callback:function(t){e.$set(e.newProduct,"categoryId",t)},expression:"newProduct.categoryId"}},e._l(e.categories,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addProductDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("newProductForm")}}},[e._v("确定")])],1)],1),t("el-dialog",{attrs:{title:"查看商品",visible:e.viewProductDialogVisible},on:{"update:visible":function(t){e.viewProductDialogVisible=t}}},[t("el-form",{attrs:{model:e.currentProduct,"label-position":"top"}},[t("el-form-item",{attrs:{label:"商品名称"}},[t("el-input",{attrs:{disabled:""},model:{value:e.currentProduct.name,callback:function(t){e.$set(e.currentProduct,"name",t)},expression:"currentProduct.name"}})],1),t("el-form-item",{attrs:{label:"商品封面图片地址"}},[t("el-input",{attrs:{readonly:""},model:{value:e.currentProduct.coverImage,callback:function(t){e.$set(e.currentProduct,"coverImage",t)},expression:"currentProduct.coverImage"}})],1),t("el-form-item",{attrs:{label:"商品封面图片"}},[t("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e.currentProduct.coverImage,alt:"商品封面图片"}})],1),t("el-form-item",{attrs:{label:"商品详情图片地址"}},e._l(e.currentProduct.detailImages,(function(e,r){return t("div",{key:r,staticStyle:{"margin-bottom":"10px"}},[t("el-input",{attrs:{value:e,readonly:""}})],1)})),0),t("el-form-item",{attrs:{label:"商品详情图片"}},e._l(e.currentProduct.detailImages,(function(e,r){return t("div",{key:r,staticStyle:{display:"inline-block","margin-right":"10px"}},[t("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e,alt:"商品详情图片"}})],1)})),0),t("el-form-item",{attrs:{label:"商品描述"}},[t("el-input",{attrs:{type:"textarea",disabled:""},model:{value:e.currentProduct.description,callback:function(t){e.$set(e.currentProduct,"description",t)},expression:"currentProduct.description"}})],1),t("el-form-item",{attrs:{label:"销售价格"}},[t("el-input",{attrs:{disabled:""},model:{value:e.currentProduct.salePrice,callback:function(t){e.$set(e.currentProduct,"salePrice",t)},expression:"currentProduct.salePrice"}})],1),t("el-form-item",{attrs:{label:"成本价格"}},[t("el-input",{attrs:{disabled:""},model:{value:e.currentProduct.costPrice,callback:function(t){e.$set(e.currentProduct,"costPrice",t)},expression:"currentProduct.costPrice"}})],1),t("el-form-item",{attrs:{label:"库存数量"}},[t("el-input",{attrs:{disabled:""},model:{value:e.currentProduct.stockQuantity,callback:function(t){e.$set(e.currentProduct,"stockQuantity",t)},expression:"currentProduct.stockQuantity"}})],1),t("el-form-item",{attrs:{label:"商品品牌"}},[t("el-input",{attrs:{disabled:""},model:{value:e.currentProduct.brand,callback:function(t){e.$set(e.currentProduct,"brand",t)},expression:"currentProduct.brand"}})],1),t("el-form-item",{attrs:{label:"商品分类ID"}},[t("el-input",{attrs:{disabled:""},model:{value:e.currentProduct.categoryId,callback:function(t){e.$set(e.currentProduct,"categoryId",t)},expression:"currentProduct.categoryId"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.viewProductDialogVisible=!1}}},[e._v("关闭")])],1)],1),t("el-dialog",{attrs:{title:"确认删除",visible:e.deleteProductDialogVisible},on:{"update:visible":function(t){e.deleteProductDialogVisible=t}}},[t("span",[e._v("你确定要删除这个商品吗？")]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.deleteProductDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.deleteProduct}},[e._v("确定")])],1)]),t("el-dialog",{attrs:{visible:e.imageDialogVisible,width:"30%"},on:{"update:visible":function(t){e.imageDialogVisible=t}}},[t("img",{staticStyle:{width:"100%"},attrs:{src:e.currentImage}})])],1)},s=[],o=(r("14d9"),r("365c")),l=r("f121"),i={name:"Products",data(){return{searchQuery:"",products:[],currentPage:1,pageSize:10,totalProducts:0,addProductDialogVisible:!1,newProduct:{name:"",coverImage:"",detailImages:[],description:"",salePrice:"",costPrice:"",stockQuantity:"",brand:null,categoryId:null},categories:[],brands:[],uploadUrl:"/api/v1/fileUpload/upload",detailImageList:[],rules:{name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],coverImage:[{required:!0,message:"请上传商品封面图片",trigger:"change"}],detailImages:[{required:!0,message:"请上传商品详情图片",trigger:"change"}],description:[{required:!0,message:"请输入商品描述",trigger:"blur"}],salePrice:[{required:!0,message:"请输入销售价格",trigger:"blur"}],costPrice:[{required:!0,message:"请输入成本价格",trigger:"blur"}],stockQuantity:[{required:!0,message:"请输入库存数量",trigger:"blur"}],brand:[{required:!0,message:"请选择商品品牌",trigger:"change"}],categoryId:[{required:!0,message:"请选择商品分类",trigger:"change"}]},viewProductDialogVisible:!1,deleteProductDialogVisible:!1,currentProduct:{},productToDelete:null,imageDialogVisible:!1,currentImage:""}},mounted(){this.fetchProducts(),this.fetchCategories(),this.fetchBrands()},methods:{async fetchProducts(){try{const e=await Object(o["s"])(this.currentPage-1,this.pageSize,"id");0===e.code?(this.products=e.data.products,this.totalProducts=e.data.total,console.log("商品列表:",e.data.products)):(this.$message.error("获取商品列表失败: "+e.message),console.log("商品列表失败:",e.message))}catch(e){this.$message.error("获取商品列表失败: "+e.message)}},fetchCategories(){Object(o["r"])().then(e=>{0===e.code?this.categories=e.data:this.$message.error("获取商品分类失败: "+e.message)}).catch(e=>{console.error("获取商品分类失败:",e)})},fetchBrands(){Object(o["l"])().then(e=>{0===e.code?this.brands=e.data:this.$message.error("获取品牌数据失败: "+e.message)}).catch(e=>{console.error("获取品牌数据失败:",e)})},async searchProducts(){try{const e=await Object(o["w"])(this.searchQuery);0===e.code?(this.products=e.data,this.totalProducts=e.data.length,console.log("搜索结果:",e.data)):(this.$message.error("搜索失败: "+e.message),console.log("搜索失败:",e.message))}catch(e){this.$message.error("搜索失败: "+e.message)}},handlePageChange(e){this.currentPage=e,this.fetchProducts()},showAddProductDialog(){this.addProductDialogVisible=!0},async addProduct(){try{const e=await Object(o["e"])(this.newProduct);0===e.code?(this.$message.success(e.message),this.addProductDialogVisible=!1,this.fetchProducts()):this.$message.error("新增失败: "+e.message)}catch(e){this.$message.error("新增失败: "+e.message)}},handleCoverUploadSuccess(e){0===e.code?(this.newProduct.coverImage=`${l["a"]}/v1/getLatestImage?fileName=${e.data}`,this.$message.success("图片上传成功")):401===e.code?this.$message.error("登录超时，请重新登录"):this.$message.error("图片上传失败: "+e.message)},handleDetailUploadSuccess(e){if(0===e.code){const t=`${l["a"]}/v1/getLatestImage?fileName=${e.data}`;this.newProduct.detailImages.push(t),this.detailImageList.push({name:e.data,url:t}),this.$message.success("图片上传成功"),console.log("商品详情图片数组:",this.newProduct.detailImages)}else 401===e.code?this.$message.error("登录超时，请重新登录"):this.$message.error("图片上传失败: "+e.message)},handleDetailRemove(e){const t=this.newProduct.detailImages.indexOf(e.url);-1!==t&&(this.newProduct.detailImages.splice(t,1),this.detailImageList.splice(t,1))},beforeUploadCover(e){const t=new FormData;return t.append("file",e),t.append("userId",window.localStorage.getItem("SET_NAME")),t.append("type","cover"),this.uploadFile(t),!1},beforeUploadDetail(e){const t=new FormData;return t.append("file",e),t.append("userId",window.localStorage.getItem("SET_NAME")),t.append("type","detail"),this.uploadFile(t),!1},async uploadFile(e){try{const t=await Object(o["C"])(e);"cover"===e.get("type")?this.handleCoverUploadSuccess(t):this.handleDetailUploadSuccess(t)}catch(t){t.response&&401===t.response.status?this.$message.error("登录超时，请重新登录"):this.$message.error("图片上传失败: "+t.message)}},submitForm(e){this.$refs[e].validate(e=>{if(!e)return this.$message.error("请填写完整的商品信息"),!1;this.addProduct()})},viewProduct(e){this.currentProduct={...e,detailImages:e.detailImages||[]},this.viewProductDialogVisible=!0,console.log("查看商品:",e)},confirmDeleteProduct(e){this.productToDelete=e,this.deleteProductDialogVisible=!0},async deleteProduct(){if(this.productToDelete)try{const e=await Object(o["i"])(this.productToDelete.id);0===e.code?(this.$message.success("删除成功"),this.fetchProducts(),this.deleteProductDialogVisible=!1,this.productToDelete=null):this.$message.error("删除失败: "+e.message)}catch(e){this.$message.error("删除失败: "+e.message)}else this.$message.error("未选择要删除的商品")},showImageDialog(e){this.currentImage=e,this.imageDialogVisible=!0}}},c=i,n=(r("afb2"),r("2877")),d=Object(n["a"])(c,a,s,!1,null,"9f6f8c48",null);t["default"]=d.exports},f527:function(e,t,r){}}]);
//# sourceMappingURL=chunk-dc243f1a.e48b5bc2.js.map